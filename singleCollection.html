<!DOCTYPE html>
<html lang="da">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krista Werdelin - One Collection</title>
    <!--    <link rel="stylesheet" href="style.css">-->
    <link rel="stylesheet" href="singleCollection.css">
    <link href="https://fonts.googleapis.com/css?family=Baskervville:400i|Montserrat|Open+Sans+Condensed:300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.typekit.net/adt6mug.css">
    <style>


    </style>
</head>

<body>
    <header class="header">
        <a href="home.html" class="logo">
            <img src="img/SVG/logo.svg" alt=""></a>
        <input class="menu-btn" type="checkbox" id="menu-btn" />
        <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>
        <ul class="menu">
            <li><a href="home.html">home</a></li>
            <li><a href="about.html">about</a></li>
            <li><a href="artworks.html">artworks</a></li>
            <li><a href="exhibitions.html">exhibitions</a></li>
            <li><a href="contact.html">contact</a></li>
        </ul>
    </header>

    <!--Breadcrumbs-->
    <div class="breadcrumbs">
        <ul>
            <li><a href="home.html">home </a></li>
            <li><a href="artworks.html">artworks</a></li>
            <li><a class="currentlink" href="singleCollection.html?id="></a></li>
        </ul>
    </div>



    <!--A template for an item on the content list-->
    <template>
        <section class="onepainting">
            <img src="" alt="">
            <h2></h2>
        </section>
    </template>

    <!--Pop-up window, showing detailed information of one painting-->
    <div class="popup">
        <button class="close">X</button>
        <section class="popup_content">
            <article class="apainting">
                <div class="left">
                    <h2></h2>
                    <div class="gallery_container">
                        <div class="onepicture">
                            <img class="picture" src="" alt="">
                        </div>
                        <!--Next and previous buttons-->
                        <a class="prev">&#10094;</a>
                        <a class="next">&#10095;</a>
                    </div>

                </div>
                <div class="right">
                    <p class="size"></p>
                    <p class="status"></p>
                    <p class="nameCol"></p>
                </div>
            </article>
        </section>
    </div>

    <!--Placing the list of data - of one collection-->
    <main id="singlecollection">
        <h1 class="title"></h1>
        <section class="onecol_list">
        </section>
        <!--
Spanning for any brick = S
   * Grid's row-gap = G
   * Size of grid's implicitly create row-track = R
   * Height of item content = H
   * Net height of the item = H1 = H + G
   * Net height of the implicit row-track = T = G + R
   * S = H1 / T
   */
-->
    </main>

    <!--Hent footer fra inc mappen-->
    <hr>
    <footer></footer>


    <script>
        const urlCol = new URLSearchParams(window.location.search);
        let id = urlCol.get("id");
        let paintings = [];
        let gallery_counter = [];

        console.log(id);

        document.addEventListener("DOMContentLoaded", start);

        function start() {
            getJson();
            getFooter();
            showAllpaintings();
            //            resizeMasonryItem(item);
            // resizeAllMasonryItems();
            // waitForImages();
            // masonryEvents.forEach(function(event) {
            // window.addEventListener(event, resizeAllMasonryItems);
            // });
        }
        async function getJson() {
            const response = await fetch("https://uwei.eu/kea/2_semester/eksamen/kristawerdelin/wordpress/wp-json/wp/v2/painting?collections=" + id + "&per_page=100");
            paintings = await response.json();
            showAllpaintings();
        }
        async function getFooter() {
            const footer = await fetch("inc/footer.html");
            const including = await footer.text();
            console.log(footer);
            document.querySelector("footer").innerHTML = including;
        }

        function showAllpaintings() {
            const pattern = document.querySelector("template");
            const gridlist = document.querySelector(".onecol_list");

            //tag fat i den første element: console.log(paintings[0].collection);
            document.querySelector(".title").textContent = paintings[0].collection;
            document.querySelector(".currentlink").textContent = paintings[0].collection;

            paintings.forEach(painting => {
                const clone = pattern.cloneNode(true).content;
                clone.querySelector("img").src = painting.picture.guid;
                clone.querySelector("h2").textContent = painting.title.rendered;

                gridlist.appendChild(clone);
                gridlist.lastElementChild.addEventListener("click", () => {
                    showOnepainting(painting)
                });
            })

        }

        function showOnepainting(painting) {
            console.log(showOnepainting);
            document.querySelector(".popup").style.display = "block";
            document.querySelector(".close").addEventListener("click", closePopup);

            document.querySelector(".apainting img").src = painting.picture.guid;
            document.querySelector(".apainting h2").textContent = painting.title.rendered;
            document.querySelector(".size").textContent = "Size: " + painting.size;
            document.querySelector(".status").textContent = "Sold: " + painting.sold;
            document.querySelector(".nameCol").textContent = "Collection: " + painting.collection;

            //controls til galleriet på pop-up vindue
            document.querySelector(".prev").addEventListener("click", clickPrev);
            document.querySelector(".next").addEventListener("click", clickNext);
        }

        function closePopup() {
            document.querySelector(".popup").style.display = "none";
            clickNext();
            clickPrev();
        }

        function clickNext() {
            console.log(clickNext);

            if (gallery_counter == paintings.length) {

                gallery_counter = 0;
            }
            gallery_counter++;

            document.querySelector(".apainting img").src = paintings[gallery_counter].picture.guid;
            document.querySelector(".apainting h2").textContent = paintings[gallery_counter].title.rendered;
            document.querySelector(".size").textContent = "Size: " + paintings[gallery_counter].size;
            document.querySelector(".status").textContent = "Sold: " + paintings[gallery_counter].sold;
            document.querySelector(".nameCol").textContent = "Collection: " + paintings[gallery_counter].collection;
        }

        function clickPrev() {
            console.log(clickPrev);
            gallery_counter--;
            if (gallery_counter < 0) {
                gallery_counter = paintings.length - 1;
            }

            document.querySelector(".apainting img").src = paintings[gallery_counter].picture.guid;
            document.querySelector(".apainting h2").textContent = paintings[gallery_counter].title.rendered;
            document.querySelector(".size").textContent = "Size: " + paintings[gallery_counter].size;
            document.querySelector(".status").textContent = "Sold: " + paintings[gallery_counter].sold;
            document.querySelector(".nameCol").textContent = "Collection: " + paintings[gallery_counter].collection;
        }

        //        function resizeMasonryItem(item) {
        //            let masonry_grid = document.querySelector(".onecol_list")[0];
        //            let rowGap = parseInt(window.getComputedStyle(masonry_grid).getPropertyValue('grid-row-gap'));
        //            let rowHeight = parseInt(window.getComputedStyle(masonry_grid).getPropertyValue('grid-auto-rows'));
        //            let rowSpan = Math.ceil((item.querySelector(".onepainting").getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));
        //
        //            item.style.gridRowEnd = 'span' + rowSpan;
        //        }
        //
        //        function resizeAllMasonryItems() {
        //            let allItems = document.querySelector(".masonry-brick");
        //            for (let i = 0; i < allItems.length; i++) {
        //                resizeMasonryItem(allItems[i]);
        //            }
        //        }
        //
        //        function waitForImages() {
        //            let allItems = document.querySelector(".masonry-brick");
        //            for (let i = 0; i < allItems.length; i++) {
        //                imagesLoaded(allItems[i], function(instance) {
        //                    let item = instance.elements[0];
        //                    resizeMasonryItem(item);
        //                });
        //            }
        //        }

    </script>
</body>

</html>
